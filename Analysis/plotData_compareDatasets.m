%% plotData_compareDatasets.m - June 2015
% Uses output from processData.m to make and save plots.
% Plots from this script are for comparing datasets. 
% For plots formatted for results within just one dataset, use plotData_oneDataSet.m
%%
close all;
%% Inputs

%!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
loadParametersFromOldFile = false; % If true, will look for a parameters.mat file in saveBaseDir/saveDirName and load these inputs from that file.
%!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
saveBaseDir = '/home/jack/PhaseFeedforward/Analysis/201612/Plots';%'/home/jack/PhaseFeedforward/Analysis/201507/R56Scan_20150703';%'/home/jack/PhaseFeedforward/Analysis/201504/Feedforward/Plots';
saveDirName = '201612_1920_straightIntlv_wiggle_gain_-1000_091216';%'Plots';

savePlots = false;
displayAll = false; % if true will make one figure window for every plot. if false will only make one (faster for saving)

plotBPM = false;

dataDir = [];%'/home/jack/PhaseFeedforward/Analysis/201511/NoMeanSub';%[] % .mat files containing output of processData.m for all dataSets must be in this directory. Leave empty to assume default directory in ~/PhaseFeedforward/Analysis/yyyyMM

dataSetNames = {...
'201612_1920_straightIntlv_wiggle_gain_-1000_091216_FFOff',...
'201612_1920_straightIntlv_wiggle_gain_-1000_091216_FFOn',...
};
dataSetLabels = {'PFF Off','PFF On'};
dataSetValues = [0 1];
dataSetValueLabel = 'PFF Status';
dataDescr = '20161209.1920 '; % Added to plot titles


% dataSetNames = {...
% % off
% '20160811_1658_GScan_-2500_Intlv_Odd',...
% '20160811_1704_GScan_-2000_Intlv_Odd',...
% '20160811_1709_GScan_-1500_Intlv_Even',...
% '20160811_1714_GScan_-1000_Intlv_Odd',...
% '20160811_1720_GScan_-500_Intlv_Even',...
% '20160811_1725_GScan_500_Intlv_Odd',...
% '20160811_1759_GScan_750_Intlv_Even',...
% '20160811_1733_GScan_1000_Intlv_Odd',...
% '20160811_1803_GScan_1250_Intlv_Odd'...
% '20160811_1738_GScan_1500_Intlv_Even',...
% '20160811_1743_GScan_2000_Intlv_Even',...
% '20160811_1751_GScan_2500_Intlv_Odd'...
% % on
% % '20160811_1658_GScan_-2500_Intlv_Even',...
% % '20160811_1704_GScan_-2000_Intlv_Even',...
% % '20160811_1709_GScan_-1500_Intlv_Odd',...
% % '20160811_1714_GScan_-1000_Intlv_Even',...
% % '20160811_1720_GScan_-500_Intlv_Odd',...
% % '20160811_1725_GScan_500_Intlv_Even',...
% % '20160811_1759_GScan_750_Intlv_Odd',...
% % '20160811_1733_GScan_1000_Intlv_Even',...
% % '20160811_1803_GScan_1250_Intlv_Even'...
% % '20160811_1738_GScan_1500_Intlv_Odd',...
% % '20160811_1743_GScan_2000_Intlv_Odd',...
% % '20160811_1751_GScan_2500_Intlv_Even'...
% };

% dataSetNames = {
% '201612_1800_straightIntlv_gain_-400_091216_FFOn',...
% % '201612_1800_straightIntlv_gain_-400_091216_FFOff',...
% '201612_1745_straightIntlv_gain_-600_091216_FFOn',...
% % '201612_1745_straightIntlv_gain_-600_091216_FFOff'...
% '201612_1745_straightIntlv_gain_-800_091216_FFOn',...
% % '201612_1745_straightIntlv_gain_-800_091216_FFOff',...
% '201612_1745_straightIntlv_gain_-1000_091216_FFOn',...
% % '201612_1745_straightIntlv_gain_-1000_091216_FFOff',...
% '201612_1745_straightIntlv_gain_-1200_091216_FFOn',...
% % '201612_1745_straightIntlv_gain_-1200_091216_FFOff',...
% '201612_1745_straightIntlv_gain_-1400_091216_FFOn',...
% % '201612_1745_straightIntlv_gain_-1400_091216_FFOff',...
% '201612_1800_straightIntlv_gain_-1600_091216_FFOn',...
% % '201612_1800_straightIntlv_gain_-1600_091216_FFOff',...
% };

% dataSetNames = {
% '201612_1835_straightIntlv_gain_-1000_091216_FFOff',...
% '201612_1835_straightIntlv_gain_-1000_091216_FFOn'};

% dataSetLabels = {'FFOff', 'FFOn'}; % dataSetNames;
% dataSetValues = 1:length(dataSetNames);%1:27; % For plot x axes (e.g. correlation vs. gain etc.)
% dataSetValueLabel = 'Dataset'; % For x label of plot axes using dataSetValues.

% dataSetLabels = dataSetNames;
% dataSetValues = [400 600 800 1000 1200 1400 1600];
% dataSetValueLabel = 'Gain';

% dataDescr = '20161216.1640.x4 '; % Added to plot titles

dataSetNames = {
'20161103_1300_TimChk_K1d_0_K2d_1_gain1000_Odd'
'20161103_1313_TimChk_K1d_4_K2d_5_gain1000_Odd'
'20161103_1255_TimChk_K1d_7_K2d_8_Even'
'20161103_1316_TimChk_K1d_10_K2d_11_gain1000_Odd'
'20161103_1306_TimChk_K1d_14_K2d_15_gain1000_Even'
'20161103_1309_TimChk_K1d_21_K2d_22_gain1000_Odd'
'20161103_1311_TimChk_K1d_28_K2d_29_gain1000_Even'
'20161103_1300_TimChk_K1d_0_K2d_1_gain1000_Even'
'20161103_1313_TimChk_K1d_4_K2d_5_gain1000_Even'
'20161103_1255_TimChk_K1d_7_K2d_8_Odd'
'20161103_1316_TimChk_K1d_10_K2d_11_gain1000_Even'
'20161103_1306_TimChk_K1d_14_K2d_15_gain1000_Odd'
'20161103_1309_TimChk_K1d_21_K2d_22_gain1000_Even'
'20161103_1311_TimChk_K1d_28_K2d_29_gain1000_Odd'
};

mixerLabels = {... % Added to plot titles, legends and file names.
    'Mon1',...
    'Mon2',...
    'Mon3'...
};

mixerColors = [0 0.8 0; 0 0 1; 1 0 0];

usePulseSampleRange = 2; % if true, use the range defined in pulseSampleRange{usePulseSampleRange} (i.e. to use mon3, usePulseSampleRange=3)
plotStartSamp = 1;%555;%25;%20; % sample range to plot
plotEndSamp = 768;%710;%75;%150;

%% load data
addpath('../');

if (loadParametersFromOldFile)
    parametersFile = [saveBaseDir '/' saveDirName '/parameters.mat'];
    if (exist(parametersFile,'file'))
        load(parametersFile);
    else
        warning(['Could not find parameters file: ' parametersFile]);
    end
end

nDataSets = length(dataSetNames);
data = cell(1,nDataSets);

for ds=1:nDataSets
    if (isempty(dataDir))
        dsDir = ['/home/jack/PhaseFeedforward/Analysis/' dataSetNames{ds}(1:6)];
    else
        dsDir = dataDir;
    end
    
    data{ds} = load([dsDir '/' dataSetNames{ds} '.mat']);
end

if (usePulseSampleRange>0)
    plotStartSamp = data{ds}.pulseSampleRange{usePulseSampleRange}(1);
    plotEndSamp = data{ds}.pulseSampleRange{usePulseSampleRange}(end);
end

if (savePlots)
    saveDir = [saveBaseDir '/' saveDirName];
    if (~exist(saveDir,'dir'))
        mkdir(saveDir);
    end
    
    % save a list of the data sets that are included in the plots
    dataSetListFile = fopen([saveDir '/dataSetList'],'w');
    for ds=1:nDataSets
        fprintf(dataSetListFile,'%s\n',dataSetNames{ds});
    end
    fclose(dataSetListFile);
    
    % save a .mat file containing the input parameters
    save([saveDir '/parameters.mat'],...
        'dataDir',...
        'dataSetNames',...
        'dataSetLabels',...
        'dataSetValues',...
        'dataSetValueLabel',...
        'dataDescr',...
        'mixerLabels',...
        'saveBaseDir',...
        'saveDirName',...
        'plotStartSamp',...
        'plotEndSamp',...
        'mixerColors',...
        'usePulseSampleRange');
end

nMons = data{1}.nMons;

figure;
format_plots;
datSetColors = varycolor(nDataSets);

return;

%% Frascati phase plots
plotData_compareDatasets_Frascati;

%% bpm correlation plots
if (plotBPM)
    plotData_compareDatasets_BPMs;
end